<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üõ°Ô∏è PONNNAR SENTINEL | BREAK INTELLIGENCE</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0a0a0f;
  --panel:#16162a;
  --green:#00ff41;
  --red:#ff003c;
  --blue:#00f3ff;
  --purple:#9d00ff;
  --gold:#ffb347;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--green);
  font-family:'Share Tech Mono', monospace;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:15px;
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:15px;
}

.panel{
  background:var(--panel);
  border-radius:14px;
  padding:15px;
  border:2px solid var(--blue);
}

h3{
  margin:0 0 10px;
  font-family:'Orbitron';
  color:var(--purple);
}

/* MAIN */
.twod{
  font-family:'Orbitron';
  font-size:5rem;
  text-align:center;
  text-shadow:0 0 25px var(--green);
}

/* BREAK GRID */
.break-grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
}

.break-box{
  border:1px solid #333;
  border-radius:8px;
  padding:8px;
  text-align:center;
  background:rgba(0,0,0,.3);
}

.break-box .digit{
  font-size:.9rem;
  color:var(--gold);
}

.break-box .count{
  font-size:1.4rem;
  font-family:'Orbitron';
}

/* LOG TABLE */
table{
  width:100%;
  border-collapse:collapse;
  font-size:.85rem;
}
th,td{
  padding:6px;
  text-align:center;
}
th{
  position:sticky;
  top:0;
  background:var(--purple);
  color:white;
}
tr:nth-child(even){background:rgba(255,255,255,.04)}
.hit{color:var(--green)}
.miss{color:var(--red)}

button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:6px;
  font-family:'Orbitron';
  font-weight:700;
  cursor:pointer;
  background:var(--green);
  color:black;
}
button.danger{background:var(--red); color:white}
</style>
</head>

<body>

<div class="container">

  <!-- LEFT -->
  <div class="panel">
    <h3>LIVE 2D</h3>
    <div id="twod" class="twod">--</div>

    <h3 style="margin-top:15px">BREAK DISTRIBUTION (0‚Äì9)</h3>
    <div id="breakGrid" class="break-grid"></div>

    <h3 style="margin-top:15px">BREAK LOG</h3>
    <div style="max-height:220px; overflow:auto">
      <table>
        <thead>
          <tr>
            <th>TIME</th>
            <th>2D</th>
            <th>BREAK</th>
            <th>RESULT</th>
          </tr>
        </thead>
        <tbody id="logBody"></tbody>
      </table>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="panel">
    <h3>STATS</h3>
    <div>HITS: <b id="hits">0</b></div>
    <div>MISSES: <b id="misses">0</b></div>
    <div>HIT RATE: <b id="rate">0%</b></div>

    <button onclick="clearSession()" class="danger">CLEAR SESSION</button>
  </div>

</div>

<script>
/* ============================
   SENTINEL CORE STATE
============================ */

const TARGET_BREAKS = [1,5,6,7,8];

let logs = [];
let hits = 0;
let misses = 0;
let last2D = null;

// Single source of truth
let breakFreq = {
  0:0,1:0,2:0,3:0,4:0,
  5:0,6:0,7:0,8:0,9:0
};

/* ============================
   UI RENDERING
============================ */

function renderBreakGrid(){
  const grid = document.getElementById('breakGrid');
  grid.innerHTML = '';

  for(let i=0;i<=9;i++){
    const box = document.createElement('div');
    box.className = 'break-box';
    box.style.color = TARGET_BREAKS.includes(i) ? 'var(--green)' : 'var(--gold)';
    box.innerHTML = `
      <div class="digit">${i}</div>
      <div class="count">${breakFreq[i]}</div>
    `;
    grid.appendChild(box);
  }
}

function renderStats(){
  document.getElementById('hits').textContent = hits;
  document.getElementById('misses').textContent = misses;
  const total = hits + misses;
  document.getElementById('rate').textContent =
    total ? ((hits/total)*100).toFixed(1)+'%' : '0%';
}

function renderLogs(){
  const body = document.getElementById('logBody');
  body.innerHTML = '';
  logs.slice(0,40).forEach(l=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${l.time}</td>
      <td>${l.twod}</td>
      <td>${l.break}</td>
      <td class="${l.hit?'hit':'miss'}">
        ${l.hit?'HIT':'MISS'}
      </td>
    `;
    body.appendChild(tr);
  });
}

/* ============================
   CORE LOGIC
============================ */

function process2D(twod){
  if(twod === last2D) return;
  last2D = twod;

  document.getElementById('twod').textContent = twod;

  const a = Number(twod[0]);
  const b = Number(twod[1]);
  const breakVal = (a + b) % 10;

  breakFreq[breakVal]++;

  const isHit = TARGET_BREAKS.includes(breakVal);
  isHit ? hits++ : misses++;

  logs.unshift({
    time: new Date().toLocaleTimeString(),
    twod,
    break: breakVal,
    hit: isHit
  });

  renderBreakGrid();
  renderStats();
  renderLogs();
}

/* ============================
   FETCH LOOP
============================ */

async function tick(){
  try{
    const r = await fetch('https://twod-server-f4df.onrender.com/api/unified-live');
    const d = await r.json();
    if(d?.live?.twod){
      process2D(d.live.twod);
    }
  }catch(e){
    console.error(e);
  }
}

setInterval(tick, 2000);

/* ============================
   CONTROLS
============================ */

function clearSession(){
  if(!confirm('Clear all session data?')) return;
  logs=[];
  hits=misses=0;
  breakFreq={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
  renderBreakGrid();
  renderStats();
  renderLogs();
}

renderBreakGrid();
</script>

</body>
</html>